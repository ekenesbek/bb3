# Clawdbot SaaS Platform - ĞŸĞ»Ğ°Ğ½ Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

## ĞĞ±Ğ·Ğ¾Ñ€ ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ°

Ğ¢Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Clawdbot Ğ¸Ğ· self-hosted Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ² multi-tenant SaaS Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ñ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ±Ğ¾Ñ‚Ğ°Ğ¼Ğ¸ Ğ¸ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¼Ğ¸ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑĞ°Ğ¼Ğ¸.

### Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SaaS Platform Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Web UI     â”‚  â”‚  Auth/Users  â”‚  â”‚   Billing    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Centralized Bot Hub (Shared Bots)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Telegram    â”‚  â”‚  WhatsApp    â”‚  â”‚   Discord    â”‚         â”‚
â”‚  â”‚  (Single Bot)â”‚  â”‚ (Single Bot) â”‚  â”‚ (Single Bot) â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ (routing by user_id)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Multi-Tenant Gateway Orchestrator                  â”‚
â”‚                    (User Context Router)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ User 1  â”‚       â”‚ User 2  â”‚      â”‚ User N  â”‚
    â”‚ Instanceâ”‚       â”‚ Instanceâ”‚      â”‚ Instanceâ”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Memory  â”‚       â”‚ Memory  â”‚      â”‚ Memory  â”‚
    â”‚ Skills  â”‚       â”‚ Skills  â”‚      â”‚ Skills  â”‚
    â”‚ Sessionsâ”‚       â”‚ Sessionsâ”‚      â”‚ Sessionsâ”‚
    â”‚ API Keysâ”‚       â”‚ API Keysâ”‚      â”‚ API Keysâ”‚
    â”‚ Config  â”‚       â”‚ Config  â”‚      â”‚ Config  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚     Shared Infrastructure Layer             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Postgres â”‚  â”‚  Redis   â”‚  â”‚ S3/Blob  â”‚  â”‚
    â”‚  â”‚  (Meta)  â”‚  â”‚ (Cache)  â”‚  â”‚ (Media)  â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Ollama/  â”‚  â”‚ Embeddingâ”‚  â”‚ Vector   â”‚  â”‚
    â”‚  â”‚ vLLM     â”‚  â”‚ Service  â”‚  â”‚ DB       â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¤Ğ°Ğ·Ñ‹ Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

### **Ğ¤Ğ°Ğ·Ğ° 0: ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ¸ ĞĞ½Ğ°Ğ»Ğ¸Ğ·** (1-2 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:
1. **ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹**
   - Ğ˜Ğ·ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³Ğ° (`src/routing/`)
   - Ğ˜Ğ·ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ ÑĞµÑÑĞ¸Ğ¹ (`src/config/sessions.ts`)
   - Ğ˜Ğ·ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¾Ğ² (`src/config/loader.ts`)
   - ĞŸĞ¾Ğ½ÑÑ‚ÑŒ Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² (`src/agents/agent-scope.ts`)

2. **ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ† Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸**
   - Ğ§Ñ‚Ğ¾ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ shared: Ğ±Ğ¾Ñ‚Ñ‹, Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸, Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°
   - Ğ§Ñ‚Ğ¾ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ per-user: Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ, skills, ÑĞµÑÑĞ¸Ğ¸, API ĞºĞ»ÑÑ‡Ğ¸, ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸
   - ĞšĞ°Ğº Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ vs Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

3. **Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑÑ‚ĞµĞºĞ°**
   - **Backend:** Node.js + Express/Fastify (ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ Ğ² gateway)
   - **Database:** PostgreSQL (Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ·ĞµÑ€Ğ¾Ğ², Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³) + SQLite per-user (sessions)
   - **Cache:** Redis (session cache, rate limiting)
   - **Storage:** S3-compatible (media files)
   - **Vector DB:** Qdrant/Weaviate (memory search)
   - **LLM Hosting:** Ollama/vLLM/Text Generation Inference
   - **Auth:** JWT + OAuth2 (Google, Apple, GitHub)
   - **Frontend:** React/Next.js + shadcn/ui

4. **ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ MVP scope**
   - ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ Ñ„Ğ¸Ñ‡ Ğ´Ğ»Ñ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ»Ğ¸Ğ·Ğ°
   - ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ² (Telegram first, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ WhatsApp)

#### Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
- Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚
- ER-Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- API ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ (OpenAPI)
- ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ (ADR - Architecture Decision Records)

---

### **Ğ¤Ğ°Ğ·Ğ° 1: Multi-Tenant Foundation** (3-4 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 1.1 User Management & Authentication

**ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:**
```
src/saas/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ jwt.ts                    # JWT token generation/validation
â”‚   â”œâ”€â”€ oauth-providers.ts        # Google, GitHub login
â”‚   â”œâ”€â”€ middleware.ts             # Auth middleware Ğ´Ğ»Ñ Express
â”‚   â””â”€â”€ session-manager.ts        # User session management
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ user-model.ts             # User data model
â”‚   â”œâ”€â”€ user-service.ts           # User CRUD operations
â”‚   â”œâ”€â”€ user-repository.ts        # Database layer
â”‚   â””â”€â”€ workspace-manager.ts      # User workspace isolation
â””â”€â”€ database/
    â”œâ”€â”€ migrations/               # Database schema migrations
    â”œâ”€â”€ connection.ts             # Database connection pool
    â””â”€â”€ schema.sql                # Initial schema
```

**Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (PostgreSQL):**
```sql
-- Users table
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE,
  username VARCHAR(100) UNIQUE NOT NULL,
  display_name VARCHAR(255),
  avatar_url TEXT,
  locale VARCHAR(10) DEFAULT 'en',
  location VARCHAR(100),          -- Ğ”Ğ»Ñ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³Ğ°
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  last_seen_at TIMESTAMP,
  status VARCHAR(20) DEFAULT 'active', -- active, suspended, deleted
  metadata JSONB DEFAULT '{}'     -- Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
);

-- User auth providers (OAuth)
CREATE TABLE user_auth_providers (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  provider VARCHAR(50) NOT NULL,  -- google, github
  provider_user_id VARCHAR(255) NOT NULL,
  access_token TEXT,
  refresh_token TEXT,
  token_expires_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  metadata JSONB DEFAULT '{}',
  UNIQUE(provider, provider_user_id)
);

-- User workspaces (isolated agent instances)
CREATE TABLE user_workspaces (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  name VARCHAR(100) NOT NULL DEFAULT 'default',
  agent_id VARCHAR(100) NOT NULL,  -- Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ agent ID
  storage_path TEXT NOT NULL,      -- ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, name)
);
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ database schema Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ User model Ğ¸ repository
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ JWT auth middleware
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ OAuth flow Ğ´Ğ»Ñ Google
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ workspace isolation Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ auth Ğ¸ user management

**API Endpoints:**
```typescript
POST   /api/v1/auth/register         # Email registration (optional)
POST   /api/v1/auth/login            # Email login
POST   /api/v1/auth/oauth/google     # Google OAuth callback
POST   /api/v1/auth/refresh          # Refresh JWT token
POST   /api/v1/auth/logout           # Logout
GET    /api/v1/users/me              # Get current user
PATCH  /api/v1/users/me              # Update user profile
DELETE /api/v1/users/me              # Delete account
```

---

#### 1.2 User Context Routing Layer

**ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:**
```
src/saas/routing/
â”œâ”€â”€ user-context-resolver.ts      # Resolve user from message
â”œâ”€â”€ tenant-router.ts              # Route to user workspace
â”œâ”€â”€ channel-multiplexer.ts        # Shared bot -> user mapping
â””â”€â”€ rate-limiter.ts               # Per-user rate limiting
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³Ğ° Ğ´Ğ»Ñ multi-tenancy

**Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³ (single-tenant):**
```typescript
// src/routing/resolve-route.ts
resolveAgentRoute({
  channel: "telegram",
  peer: { kind: "dm", id: "1234567890" }
}) -> { agentId: "default", sessionKey: "..." }
```

**ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³ (multi-tenant):**
```typescript
// src/saas/routing/user-context-resolver.ts
resolveUserContext({
  channel: "telegram",
  peer: { kind: "dm", id: "1234567890" }
}) -> {
  userId: "uuid-...",
  workspaceId: "uuid-...",
  agentId: "user-uuid-default",
  sessionKey: "user-uuid.default.main.telegram.dm.1234567890"
}
```

**User-Channel Connection Table:**
```sql
-- User messaging channel connections
CREATE TABLE user_channel_connections (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  channel VARCHAR(50) NOT NULL,    -- telegram, whatsapp, discord
  channel_user_id VARCHAR(255) NOT NULL, -- Peer ID Ğ² ĞºĞ°Ğ½Ğ°Ğ»Ğµ
  channel_username VARCHAR(255),
  display_name VARCHAR(255),
  connected_at TIMESTAMP DEFAULT NOW(),
  last_message_at TIMESTAMP,
  status VARCHAR(20) DEFAULT 'active', -- active, disconnected
  metadata JSONB DEFAULT '{}',
  UNIQUE(channel, channel_user_id)
);

-- Index Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° user Ğ¿Ğ¾ channel ID
CREATE INDEX idx_channel_connections_lookup
  ON user_channel_connections(channel, channel_user_id);
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ user_channel_connections Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ UserContextResolver
- [ ] ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ gateway Ğ´Ğ»Ñ user context injection
- [ ] ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ channel handlers (Telegram, WhatsApp)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ per-user rate limiting (Redis)
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³Ğ°

---

#### 1.3 Workspace Isolation

**Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° (single-tenant):**
```
~/.clawdbot/
â”œâ”€â”€ agents/
â”‚   â””â”€â”€ default/
â”‚       â”œâ”€â”€ workspace/
â”‚       â”œâ”€â”€ skills/
â”‚       â””â”€â”€ sessions/
â”œâ”€â”€ config.json
â””â”€â”€ sessions/
```

**ĞĞ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° (multi-tenant):**
```
/data/clawdbot/users/
â”œâ”€â”€ <user-id-1>/
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â””â”€â”€ default/
â”‚   â”‚       â”œâ”€â”€ workspace/
â”‚   â”‚       â”œâ”€â”€ skills/
â”‚   â”‚       â””â”€â”€ sessions/
â”‚   â”œâ”€â”€ config.json          # Per-user config
â”‚   â”œâ”€â”€ media/               # User media storage
â”‚   â””â”€â”€ memory/              # Memory storage
â”œâ”€â”€ <user-id-2>/
â”‚   â””â”€â”€ ...
â””â”€â”€ <user-id-N>/
    â””â”€â”€ ...
```

**Workspace Manager:**
```typescript
// src/saas/users/workspace-manager.ts
class WorkspaceManager {
  // Get user workspace path
  getUserWorkspacePath(userId: string): string {
    return `/data/clawdbot/users/${userId}`;
  }

  // Initialize user workspace
  async initializeWorkspace(userId: string): Promise<void> {
    const workspacePath = this.getUserWorkspacePath(userId);
    await fs.mkdir(`${workspacePath}/agents/default/workspace`, { recursive: true });
    await fs.mkdir(`${workspacePath}/agents/default/skills`, { recursive: true });
    await fs.mkdir(`${workspacePath}/agents/default/sessions`, { recursive: true });
    await fs.mkdir(`${workspacePath}/media`, { recursive: true });
    await fs.mkdir(`${workspacePath}/memory`, { recursive: true });

    // Create default config
    await this.createDefaultConfig(userId, workspacePath);
  }

  // Load user config
  async loadUserConfig(userId: string): Promise<ClawdbotConfig> {
    const configPath = `${this.getUserWorkspacePath(userId)}/config.json`;
    return await loadConfig(configPath);
  }

  // Save user config
  async saveUserConfig(userId: string, config: ClawdbotConfig): Promise<void> {
    const configPath = `${this.getUserWorkspacePath(userId)}/config.json`;
    await fs.writeFile(configPath, JSON.stringify(config, null, 2));
  }
}
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ WorkspaceManager
- [ ] ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ config loader Ğ´Ğ»Ñ multi-tenant
- [ ] ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ session store Ğ´Ğ»Ñ user isolation
- [ ] ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ media store Ğ´Ğ»Ñ user isolation
- [ ] ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ agent-scope.ts Ğ´Ğ»Ñ user workspaces
- [ ] Disk quota management (per-user limits)
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ workspace isolation

---

### **Ğ¤Ğ°Ğ·Ğ° 2: Centralized Bot Hub** (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 2.1 Shared Bot Infrastructure

**ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ:**
Ğ’Ğ¼ĞµÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ³Ğ¾ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ» ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ°, Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ…Ğ±Ğ¾Ñ‚Ğ¾Ğ², ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ¸Ñ€ÑƒÑÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğº Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ¼Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.

**Telegram Bot Hub:**
```typescript
// src/saas/bots/telegram-hub.ts
class TelegramBotHub {
  private bot: Bot;
  private userContextResolver: UserContextResolver;

  async handleMessage(ctx: Context) {
    const telegramUserId = ctx.from?.id.toString();

    // 1. Resolve user context
    const userContext = await this.userContextResolver.resolveByChannel({
      channel: "telegram",
      channelUserId: telegramUserId,
    });

    if (!userContext) {
      // User not connected yet - show onboarding
      await this.showOnboardingMessage(ctx);
      return;
    }

    // 2. Load user workspace config
    const userConfig = await this.workspaceManager.loadUserConfig(userContext.userId);

    // 3. Dispatch to user's agent
    await this.dispatchToUserAgent({
      userId: userContext.userId,
      workspaceId: userContext.workspaceId,
      message: ctx.message,
      config: userConfig,
    });
  }

  async showOnboardingMessage(ctx: Context) {
    await ctx.reply(
      "ğŸ‘‹ Welcome to Clawdbot!\n\n" +
      "To get started, please register at https://app.clawdbot.io\n" +
      "Then connect your Telegram account.",
      {
        reply_markup: {
          inline_keyboard: [
            [{ text: "Register Now ğŸš€", url: "https://app.clawdbot.io/register" }],
          ],
        },
      }
    );
  }
}
```

**User Onboarding Flow:**
```
1. User -> /start Ğ² Telegram Ğ±Ğ¾Ñ‚Ğµ
2. Bot -> "Please register at app.clawdbot.io"
3. User -> Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ
4. User -> ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "Connect Telegram"
5. Website -> Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ one-time code
6. User -> ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ code Ğ±Ğ¾Ñ‚Ñƒ
7. Bot -> Ğ¡Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµÑ‚ Telegram ID Ñ User ID
8. User -> ĞœĞ¾Ğ¶ĞµÑ‚ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¾Ğ±Ñ‰Ğ°Ñ‚ÑŒÑÑ
```

**Connection Flow Table:**
```sql
-- One-time connection codes
CREATE TABLE channel_connection_codes (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  channel VARCHAR(50) NOT NULL,
  code VARCHAR(20) UNIQUE NOT NULL,  -- ĞĞ´Ğ½Ğ¾Ñ€Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ´
  expires_at TIMESTAMP NOT NULL,
  used_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_connection_codes_lookup ON channel_connection_codes(code, channel);
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ TelegramBotHub
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ connection code generation
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ connection flow Ğ² Ğ±Ğ¾Ñ‚Ğµ
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ onboarding messages
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ WhatsAppBotHub (Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾)
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ DiscordBotHub (Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾)
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ bot hub

**API Endpoints:**
```typescript
POST   /api/v1/channels/generate-code     # Generate connection code
POST   /api/v1/channels/connect            # Connect channel (via code)
GET    /api/v1/channels/connections        # List user's connections
DELETE /api/v1/channels/connections/:id    # Disconnect channel
```

---

#### 2.2 Channel Connection UI

**Web UI Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²:**
```typescript
// Web interface (React component)
function ChannelConnectionPage() {
  return (
    <div>
      <h2>Connect Messaging Channels</h2>

      {/* Telegram */}
      <ChannelCard
        name="Telegram"
        icon={<TelegramIcon />}
        connected={user.channels.telegram}
        onConnect={() => connectTelegram()}
      />

      {/* WhatsApp */}
      <ChannelCard
        name="WhatsApp"
        icon={<WhatsAppIcon />}
        connected={user.channels.whatsapp}
        onConnect={() => connectWhatsApp()}
      />

      {/* Discord */}
      <ChannelCard
        name="Discord"
        icon={<DiscordIcon />}
        connected={user.channels.discord}
        onConnect={() => connectDiscord()}
      />
    </div>
  );
}

async function connectTelegram() {
  // 1. Generate code
  const { code } = await api.post("/api/v1/channels/generate-code", {
    channel: "telegram",
  });

  // 2. Show instructions
  showModal({
    title: "Connect Telegram",
    content: (
      <>
        <p>Send this code to our bot:</p>
        <Code>{code}</Code>
        <p>Bot: <a href="https://t.me/clawdbot">@clawdbot</a></p>
      </>
    ),
  });

  // 3. Poll for connection status
  pollConnectionStatus(code);
}
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ UI Ğ´Ğ»Ñ channel connections
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ connection code flow
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ QR code Ğ´Ğ»Ñ WhatsApp (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ OAuth Ğ´Ğ»Ñ Discord
- [ ] ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ UI

---

### **Ğ¤Ğ°Ğ·Ğ° 3: User Configuration & API Keys** (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 3.1 User Model Configuration

**Per-User Config Structure:**
```json
{
  "agents": {
    "defaults": {
      "provider": "platform",        // "platform" or custom provider
      "model": "llama-3.1-8b",       // Hosted model
      "temperature": 0.7,
      "maxTokens": 2048
    }
  },
  "providers": {
    "platform": {
      "enabled": true,               // Use platform models
      "models": ["llama-3.1-8b", "mistral-7b"]
    },
    "anthropic": {
      "enabled": false,
      "apiKey": "encrypted-key"      // User's own API key
    },
    "openai": {
      "enabled": false,
      "apiKey": "encrypted-key"
    }
  },
  "session": {
    "dmScope": "per-peer"
  },
  "features": {
    "webSearch": true,               // Enable web search
    "imageGeneration": false,        // Premium feature
    "voiceMode": false               // Premium feature
  }
}
```

**Database Schema:**
```sql
-- User API keys (encrypted)
CREATE TABLE user_api_keys (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  provider VARCHAR(50) NOT NULL,    -- anthropic, openai, etc.
  key_name VARCHAR(100),            -- User-friendly name
  encrypted_key TEXT NOT NULL,      -- Encrypted API key
  encryption_iv TEXT NOT NULL,      -- IV for AES encryption
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  last_used_at TIMESTAMP,
  UNIQUE(user_id, provider, key_name)
);

-- User model preferences
CREATE TABLE user_model_preferences (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  provider VARCHAR(50) NOT NULL,
  model VARCHAR(100) NOT NULL,
  is_default BOOLEAN DEFAULT false,
  temperature DECIMAL(3,2),
  max_tokens INTEGER,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**API Key Encryption Service:**
```typescript
// src/saas/security/key-encryption.ts
import crypto from "crypto";

class KeyEncryptionService {
  private masterKey: Buffer;

  constructor() {
    // Master key Ğ¸Ğ· environment variable (rotate periodically)
    this.masterKey = Buffer.from(process.env.MASTER_ENCRYPTION_KEY!, "hex");
  }

  encryptApiKey(apiKey: string): { encrypted: string; iv: string } {
    const iv = crypto.randomBytes(16);
    const cipher = crypto.createCipheriv("aes-256-gcm", this.masterKey, iv);

    let encrypted = cipher.update(apiKey, "utf8", "hex");
    encrypted += cipher.final("hex");

    const authTag = cipher.getAuthTag();

    return {
      encrypted: encrypted + authTag.toString("hex"),
      iv: iv.toString("hex"),
    };
  }

  decryptApiKey(encrypted: string, iv: string): string {
    const ivBuffer = Buffer.from(iv, "hex");
    const encryptedBuffer = Buffer.from(encrypted.slice(0, -32), "hex");
    const authTag = Buffer.from(encrypted.slice(-32), "hex");

    const decipher = crypto.createDecipheriv("aes-256-gcm", this.masterKey, ivBuffer);
    decipher.setAuthTag(authTag);

    let decrypted = decipher.update(encryptedBuffer);
    decrypted = Buffer.concat([decrypted, decipher.final()]);

    return decrypted.toString("utf8");
  }
}
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ user_api_keys Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ KeyEncryptionService
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ API Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ per-user config storage
- [ ] ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ model selection Ğ´Ğ»Ñ user-specific providers
- [ ] UI Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ API ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ encryption Ğ¸ key management

**API Endpoints:**
```typescript
GET    /api/v1/config                      # Get user config
PATCH  /api/v1/config                      # Update user config

POST   /api/v1/api-keys                    # Add API key
GET    /api/v1/api-keys                    # List API keys (masked)
PATCH  /api/v1/api-keys/:id                # Update API key
DELETE /api/v1/api-keys/:id                # Delete API key

GET    /api/v1/models/available            # List available models
PATCH  /api/v1/models/preferences          # Set model preferences
```

---

#### 3.2 Platform-Hosted Models

**Self-Hosted LLM Infrastructure:**

**Option 1: Ollama (Ğ¿Ñ€Ğ¾Ñ‰Ğµ Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°):**
```yaml
# docker-compose.yml
services:
  ollama:
    image: ollama/ollama:latest
    volumes:
      - ollama-models:/root/.ollama
    ports:
      - "11434:11434"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

volumes:
  ollama-models:
```

**Option 2: vLLM (Ğ´Ğ»Ñ production, Ğ±Ğ¾Ğ»ĞµĞµ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹):**
```yaml
services:
  vllm:
    image: vllm/vllm-openai:latest
    command: >
      --model meta-llama/Llama-3.1-8B-Instruct
      --served-model-name llama-3.1-8b
      --max-model-len 4096
      --gpu-memory-utilization 0.9
    environment:
      - HF_TOKEN=${HF_TOKEN}
    ports:
      - "8000:8000"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
```

**Model Proxy Service:**
```typescript
// src/saas/models/platform-model-proxy.ts
class PlatformModelProxy {
  private ollama: Ollama;
  private rateLimiter: RateLimiter;

  async chat(request: ChatRequest, userId: string): Promise<ChatResponse> {
    // 1. Check rate limits
    await this.rateLimiter.checkLimit(userId, "model-requests");

    // 2. Track usage
    await this.trackUsage(userId, request.model, {
      inputTokens: estimateTokens(request.messages),
    });

    // 3. Call model
    const response = await this.ollama.chat({
      model: request.model,
      messages: request.messages,
      stream: request.stream,
    });

    // 4. Track output
    await this.trackUsage(userId, request.model, {
      outputTokens: estimateTokens(response.message.content),
    });

    return response;
  }
}
```

**Usage Tracking:**
```sql
-- Model usage tracking
CREATE TABLE model_usage (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  provider VARCHAR(50) NOT NULL,
  model VARCHAR(100) NOT NULL,
  input_tokens INTEGER DEFAULT 0,
  output_tokens INTEGER DEFAULT 0,
  cached_tokens INTEGER DEFAULT 0,
  request_count INTEGER DEFAULT 1,
  cost_usd DECIMAL(10,6) DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Indexes Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
CREATE INDEX idx_usage_user_time ON model_usage(user_id, created_at DESC);
CREATE INDEX idx_usage_model ON model_usage(model, created_at DESC);
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Setup Ollama/vLLM infrastructure
- [ ] Deploy baseline models (Llama 3.1 8B, Mistral 7B)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ PlatformModelProxy
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ usage tracking
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ rate limiting per user
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ cost calculation
- [ ] Monitoring Ğ¸ alerting Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ model proxy

**Available Models (Phase 1):**
- `llama-3.1-8b-instruct` (general purpose)
- `mistral-7b-instruct` (fast, efficient)
- `phi-3-mini` (lightweight)

---

### **Ğ¤Ğ°Ğ·Ğ° 4: Web Search & External Integrations** (2 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 4.1 Web Search Integration

**Search Provider Options:**
- **SearXNG** (self-hosted, free)
- **Brave Search API** (paid, Ğ½Ğ¾ generous free tier)
- **Google Programmable Search** (limited free tier)

**SearXNG Setup (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ):**
```yaml
# docker-compose.yml
services:
  searxng:
    image: searxng/searxng:latest
    volumes:
      - ./searxng:/etc/searxng
    ports:
      - "8080:8080"
    environment:
      - BASE_URL=https://search.clawdbot.io
      - INSTANCE_NAME=Clawdbot Search
```

**Search Tool Integration:**
```typescript
// src/saas/tools/web-search.ts
class WebSearchTool {
  private searxng: SearXNGClient;
  private rateLimiter: RateLimiter;

  async search(query: string, userId: string): Promise<SearchResults> {
    // Check rate limits (10 searches per hour for free tier)
    await this.rateLimiter.checkLimit(userId, "web-search", {
      max: 10,
      window: 3600,
    });

    const results = await this.searxng.search({
      q: query,
      engines: "google,duckduckgo,brave",
      format: "json",
      safesearch: 1,
    });

    return this.formatResults(results);
  }
}
```

**Usage Tracking:**
```sql
-- Web search usage
CREATE TABLE web_search_usage (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  query TEXT NOT NULL,
  results_count INTEGER,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Rate limiting
CREATE INDEX idx_search_user_time ON web_search_usage(user_id, created_at DESC);
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Setup SearXNG instance
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ WebSearchTool
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² agent tools
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ rate limiting
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ usage tracking
- [ ] UI Ğ´Ğ»Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ/Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ web search
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ search tool

---

### **Ğ¤Ğ°Ğ·Ğ° 5: Web Dashboard & User Interface** (3-4 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 5.1 Frontend Architecture

**Tech Stack:**
- **Framework:** Next.js 14 (App Router)
- **UI Library:** shadcn/ui + Radix UI
- **Styling:** Tailwind CSS
- **State:** Zustand + React Query
- **Auth:** NextAuth.js
- **API Client:** tRPC or REST with Axios

**Directory Structure:**
```
apps/web/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â””â”€â”€ oauth-callback/
â”‚   â”œâ”€â”€ (dashboard)/
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ page.tsx              # Dashboard home
â”‚   â”‚   â”œâ”€â”€ channels/             # Channel connections
â”‚   â”‚   â”œâ”€â”€ models/               # Model config
â”‚   â”‚   â”œâ”€â”€ api-keys/             # API key management
â”‚   â”‚   â”œâ”€â”€ sessions/             # Chat sessions
â”‚   â”‚   â”œâ”€â”€ settings/             # User settings
â”‚   â”‚   â””â”€â”€ billing/              # Billing (future)
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ [...]/route.ts        # API routes
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                       # shadcn components
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â””â”€â”€ stats-card.tsx
â”‚   â”œâ”€â”€ channels/
â”‚   â”‚   â”œâ”€â”€ channel-card.tsx
â”‚   â”‚   â””â”€â”€ connection-modal.tsx
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ model-selector.tsx
â”‚       â””â”€â”€ model-config-form.tsx
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api-client.ts
â”‚   â”œâ”€â”€ auth.ts
â”‚   â””â”€â”€ utils.ts
â””â”€â”€ styles/
    â””â”€â”€ globals.css
```

#### 5.2 Key UI Pages

**1. Dashboard Home:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Clawdbot Dashboard                      [User Menu â–¼]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Welcome back, John! ğŸ‘‹                                â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Messages     â”‚  â”‚ Tokens Used  â”‚  â”‚ Active Chats â”‚ â”‚
â”‚  â”‚   1,234      â”‚  â”‚   45.2K      â”‚  â”‚      3       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  Connected Channels:                                   â”‚
â”‚  âœ… Telegram (@john)        âŒ WhatsApp                â”‚
â”‚  âŒ Discord                  âŒ Slack                  â”‚
â”‚                                                         â”‚
â”‚  Recent Activity:                                      â”‚
â”‚  [Chat session list with timestamps]                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. Channel Connections Page:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Connect Messaging Channels                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ“± Telegram                   [Connected âœ…]  â”‚    â”‚
â”‚  â”‚  @john                                          â”‚    â”‚
â”‚  â”‚  Connected 2 days ago                          â”‚    â”‚
â”‚  â”‚  [Disconnect]                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ’¬ WhatsApp                [Connect]          â”‚    â”‚
â”‚  â”‚  Chat with AI via WhatsApp                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ® Discord                 [Connect]          â”‚    â”‚
â”‚  â”‚  Add bot to your server                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**3. Model Configuration Page:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Model Configuration                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Default Model:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ [âš¡] Platform Models                          â”‚     â”‚
â”‚  â”‚   â””â”€ Llama 3.1 8B Instruct (Recommended)     â”‚     â”‚
â”‚  â”‚   â””â”€ Mistral 7B Instruct                     â”‚     â”‚
â”‚  â”‚   â””â”€ Phi-3 Mini                              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â”‚  Custom API Keys:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ [+] Add Custom Provider                       â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚ ğŸ§  Anthropic Claude                          â”‚     â”‚
â”‚  â”‚ [Add API Key]                                â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚ ğŸ¤– OpenAI GPT                                â”‚     â”‚
â”‚  â”‚ [Add API Key]                                â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â”‚  Advanced Settings:                                    â”‚
â”‚  Temperature: [slider 0-2]  0.7                       â”‚
â”‚  Max Tokens: [input]  2048                            â”‚
â”‚                                                         â”‚
â”‚  [Save Changes]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**4. Sessions/Chat History Page:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat Sessions                           [New Chat +]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Filters: [All Channels â–¼] [Last 7 days â–¼]            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“± Telegram - @john                            â”‚    â”‚
â”‚  â”‚ "Help me debug this Python code..."           â”‚    â”‚
â”‚  â”‚ 2 hours ago â€¢ 15 messages                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ’¬ WhatsApp - +1234567890                     â”‚    â”‚
â”‚  â”‚ "What's the weather like today?"              â”‚    â”‚
â”‚  â”‚ 1 day ago â€¢ 3 messages                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  [Load More]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Setup Next.js project
- [ ] Implement authentication UI
- [ ] Implement dashboard home
- [ ] Implement channel connections UI
- [ ] Implement model configuration UI
- [ ] Implement sessions/history UI
- [ ] Implement settings page
- [ ] Implement API key management UI
- [ ] Responsive design (mobile-friendly)
- [ ] Dark mode support
- [ ] i18n support (en, ru)
- [ ] E2E tests (Playwright)

---

### **Ğ¤Ğ°Ğ·Ğ° 6: Billing & Subscription Management** (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 6.1 Pricing Tiers

**Proposed Pricing:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FREE TIER                                           â”‚
â”‚  â€¢ Platform models (Llama 3.1 8B, Mistral 7B)       â”‚
â”‚  â€¢ 100 messages/day                                  â”‚
â”‚  â€¢ 1 connected channel                               â”‚
â”‚  â€¢ 10 web searches/day                               â”‚
â”‚  â€¢ 100 MB storage                                    â”‚
â”‚  Price: $0/month                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRO TIER                                            â”‚
â”‚  â€¢ All platform models                               â”‚
â”‚  â€¢ 1,000 messages/day                                â”‚
â”‚  â€¢ Unlimited channels                                â”‚
â”‚  â€¢ 100 web searches/day                              â”‚
â”‚  â€¢ Custom API keys (Claude, GPT-4)                   â”‚
â”‚  â€¢ 10 GB storage                                     â”‚
â”‚  â€¢ Priority support                                  â”‚
â”‚  Price: $10/month                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEAM TIER                                           â”‚
â”‚  â€¢ All Pro features                                  â”‚
â”‚  â€¢ 10,000 messages/day                               â”‚
â”‚  â€¢ Multi-user workspaces                             â”‚
â”‚  â€¢ Unlimited web searches                            â”‚
â”‚  â€¢ 100 GB storage                                    â”‚
â”‚  â€¢ Custom model deployments                          â”‚
â”‚  â€¢ Dedicated support                                 â”‚
â”‚  Price: $50/month                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Database Schema:**
```sql
-- Subscription plans
CREATE TABLE subscription_plans (
  id SERIAL PRIMARY KEY,
  name VARCHAR(50) UNIQUE NOT NULL,  -- free, pro, team
  display_name VARCHAR(100) NOT NULL,
  price_monthly_usd DECIMAL(10,2) NOT NULL,
  price_yearly_usd DECIMAL(10,2),
  features JSONB NOT NULL,
  limits JSONB NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);

-- User subscriptions
CREATE TABLE user_subscriptions (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  plan_id INTEGER REFERENCES subscription_plans(id),
  status VARCHAR(20) NOT NULL,       -- active, cancelled, past_due
  current_period_start TIMESTAMP NOT NULL,
  current_period_end TIMESTAMP NOT NULL,
  cancel_at_period_end BOOLEAN DEFAULT false,
  stripe_subscription_id VARCHAR(255),
  stripe_customer_id VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Usage tracking for billing
CREATE TABLE usage_records (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  metric VARCHAR(50) NOT NULL,       -- messages, searches, storage
  amount INTEGER NOT NULL,
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 6.2 Rate Limiting & Quota Management

**Rate Limiter (Redis-based):**
```typescript
// src/saas/billing/rate-limiter.ts
class RateLimiter {
  private redis: Redis;

  async checkLimit(
    userId: string,
    metric: string,
    options?: { max?: number; window?: number }
  ): Promise<{ allowed: boolean; remaining: number; resetAt: Date }> {
    // Get user plan
    const subscription = await this.getSubscription(userId);
    const plan = await this.getPlan(subscription.planId);

    // Get limit for metric
    const limit = options?.max ?? plan.limits[metric];
    const window = options?.window ?? 86400; // 24h default

    // Check Redis
    const key = `rate:${userId}:${metric}:${this.getCurrentWindow(window)}`;
    const current = await this.redis.incr(key);

    if (current === 1) {
      await this.redis.expire(key, window);
    }

    const allowed = current <= limit;
    const remaining = Math.max(0, limit - current);
    const resetAt = new Date(Date.now() + window * 1000);

    if (!allowed) {
      throw new RateLimitError(`Rate limit exceeded for ${metric}`);
    }

    return { allowed, remaining, resetAt };
  }
}
```

**Middleware Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ĞºĞ²Ğ¾Ñ‚:**
```typescript
// src/saas/middleware/quota-check.ts
export function requireQuota(metric: string) {
  return async (req: Request, res: Response, next: NextFunction) => {
    const userId = req.user.id;

    try {
      const result = await rateLimiter.checkLimit(userId, metric);

      // Add headers
      res.set("X-RateLimit-Limit", result.limit.toString());
      res.set("X-RateLimit-Remaining", result.remaining.toString());
      res.set("X-RateLimit-Reset", result.resetAt.toISOString());

      next();
    } catch (error) {
      if (error instanceof RateLimitError) {
        return res.status(429).json({
          error: "Rate limit exceeded",
          message: error.message,
          upgradeUrl: "https://app.clawdbot.io/upgrade",
        });
      }
      next(error);
    }
  };
}
```

#### 6.3 Stripe Integration

**Payment Processing:**
```typescript
// src/saas/billing/stripe-service.ts
import Stripe from "stripe";

class StripeService {
  private stripe: Stripe;

  async createCustomer(user: User): Promise<string> {
    const customer = await this.stripe.customers.create({
      email: user.email,
      metadata: { userId: user.id },
    });
    return customer.id;
  }

  async createSubscription(
    customerId: string,
    priceId: string
  ): Promise<Stripe.Subscription> {
    return await this.stripe.subscriptions.create({
      customer: customerId,
      items: [{ price: priceId }],
      payment_behavior: "default_incomplete",
      expand: ["latest_invoice.payment_intent"],
    });
  }

  async handleWebhook(event: Stripe.Event): Promise<void> {
    switch (event.type) {
      case "customer.subscription.created":
        await this.handleSubscriptionCreated(event.data.object);
        break;
      case "customer.subscription.updated":
        await this.handleSubscriptionUpdated(event.data.object);
        break;
      case "customer.subscription.deleted":
        await this.handleSubscriptionDeleted(event.data.object);
        break;
      case "invoice.payment_succeeded":
        await this.handlePaymentSucceeded(event.data.object);
        break;
      case "invoice.payment_failed":
        await this.handlePaymentFailed(event.data.object);
        break;
    }
  }
}
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Create subscription plans Ğ² Ğ‘Ğ”
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ RateLimiter (Redis)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ quota middleware
- [ ] Integrate Stripe SDK
- [ ] Implement subscription creation flow
- [ ] Implement webhook handlers
- [ ] Implement upgrade/downgrade flow
- [ ] Implement cancellation flow
- [ ] UI Ğ´Ğ»Ñ billing (pricing page, checkout, manage subscription)
- [ ] Email notifications (payment success, failure, etc.)
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ billing

**API Endpoints:**
```typescript
GET    /api/v1/billing/plans              # List available plans
POST   /api/v1/billing/checkout           # Create checkout session
GET    /api/v1/billing/subscription       # Get current subscription
POST   /api/v1/billing/subscription       # Update subscription
DELETE /api/v1/billing/subscription       # Cancel subscription
GET    /api/v1/billing/usage              # Get usage stats
POST   /api/v1/billing/webhook            # Stripe webhooks
```

---

### **Ğ¤Ğ°Ğ·Ğ° 7: Deployment & Infrastructure** (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 7.1 Infrastructure Architecture

**Deployment Stack:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Load Balancer (Nginx)                â”‚
â”‚                  SSL Termination (Let's Encrypt)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚             â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚  Web    â”‚   â”‚  API    â”‚  â”‚ Gateway â”‚
    â”‚  (Next) â”‚   â”‚  Server â”‚  â”‚ Server  â”‚
    â”‚  x2     â”‚   â”‚  x3     â”‚  â”‚  x2     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                       â”‚            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚            â”‚             â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Postgres â”‚   â”‚  Redis  â”‚  â”‚ Ollama â”‚   â”‚ S3     â”‚
    â”‚(Primary)â”‚   â”‚ (Cache) â”‚  â”‚ (GPU)  â”‚   â”‚(Media) â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Postgres â”‚
    â”‚(Replica)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Containerization (Docker Compose Ğ´Ğ»Ñ dev, Kubernetes Ğ´Ğ»Ñ prod):**

**Development (docker-compose.yml):**
```yaml
version: "3.9"

services:
  # Web UI
  web:
    build:
      context: .
      dockerfile: apps/web/Dockerfile
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgresql://clawdbot:password@postgres:5432/clawdbot
      - REDIS_URL=redis://redis:6379
      - NEXTAUTH_URL=http://localhost:3000
    depends_on:
      - postgres
      - redis

  # API Server
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    ports:
      - "4000:4000"
    environment:
      - DATABASE_URL=postgresql://clawdbot:password@postgres:5432/clawdbot
      - REDIS_URL=redis://redis:6379
      - MASTER_ENCRYPTION_KEY=${MASTER_ENCRYPTION_KEY}
    depends_on:
      - postgres
      - redis
    volumes:
      - user-workspaces:/data/clawdbot/users

  # Gateway Server
  gateway:
    build:
      context: .
      dockerfile: Dockerfile.gateway
    ports:
      - "18789:18789"
    environment:
      - DATABASE_URL=postgresql://clawdbot:password@postgres:5432/clawdbot
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
      - ollama
    volumes:
      - user-workspaces:/data/clawdbot/users

  # Ollama (LLM inference)
  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - ollama-models:/root/.ollama
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  # PostgreSQL
  postgres:
    image: postgres:16-alpine
    environment:
      - POSTGRES_DB=clawdbot
      - POSTGRES_USER=clawdbot
      - POSTGRES_PASSWORD=password
    ports:
      - "5432:5432"
    volumes:
      - postgres-data:/var/lib/postgresql/data

  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

  # SearXNG (web search)
  searxng:
    image: searxng/searxng:latest
    ports:
      - "8080:8080"
    volumes:
      - ./searxng:/etc/searxng

  # MinIO (S3-compatible storage)
  minio:
    image: minio/minio:latest
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      - MINIO_ROOT_USER=minioadmin
      - MINIO_ROOT_PASSWORD=minioadmin
    volumes:
      - minio-data:/data

volumes:
  postgres-data:
  redis-data:
  ollama-models:
  minio-data:
  user-workspaces:
```

**Production (Kubernetes Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚):**
```yaml
# api-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: clawdbot-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: clawdbot-api
  template:
    metadata:
      labels:
        app: clawdbot-api
    spec:
      containers:
        - name: api
          image: clawdbot/api:latest
          ports:
            - containerPort: 4000
          env:
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: clawdbot-secrets
                  key: database-url
            - name: REDIS_URL
              valueFrom:
                secretKeyRef:
                  name: clawdbot-secrets
                  key: redis-url
          volumeMounts:
            - name: user-workspaces
              mountPath: /data/clawdbot/users
      volumes:
        - name: user-workspaces
          persistentVolumeClaim:
            claimName: user-workspaces-pvc
```

#### 7.2 CI/CD Pipeline

**GitHub Actions Workflow:**
```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - uses: actions/setup-node@v3
        with:
          node-version: 22
          cache: "pnpm"
      - run: pnpm install
      - run: pnpm lint
      - run: pnpm build
      - run: pnpm test

  build-and-push:
    needs: test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: docker/setup-buildx-action@v2
      - uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Build and push API
      - uses: docker/build-push-action@v4
        with:
          context: .
          file: Dockerfile.api
          push: true
          tags: ghcr.io/${{ github.repository }}/api:latest

      # Build and push Gateway
      - uses: docker/build-push-action@v4
        with:
          context: .
          file: Dockerfile.gateway
          push: true
          tags: ghcr.io/${{ github.repository }}/gateway:latest

      # Build and push Web
      - uses: docker/build-push-action@v4
        with:
          context: .
          file: apps/web/Dockerfile
          push: true
          tags: ghcr.io/${{ github.repository }}/web:latest

  deploy:
    needs: build-and-push
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to production
        run: |
          # SSH to server and pull latest images
          # Or use Kubernetes kubectl apply
          # Or use Terraform/Pulumi
```

#### 7.3 Monitoring & Observability

**Monitoring Stack:**
- **Metrics:** Prometheus + Grafana
- **Logs:** Loki Ğ¸Ğ»Ğ¸ ELK stack
- **Tracing:** Jaeger (optional)
- **Uptime:** UptimeRobot Ğ¸Ğ»Ğ¸ Checkly
- **Error Tracking:** Sentry

**Key Metrics:**
```typescript
// src/saas/monitoring/metrics.ts
import { Counter, Histogram, Gauge } from "prom-client";

// Request metrics
export const httpRequestDuration = new Histogram({
  name: "http_request_duration_seconds",
  help: "Duration of HTTP requests in seconds",
  labelNames: ["method", "route", "status_code"],
});

export const httpRequestsTotal = new Counter({
  name: "http_requests_total",
  help: "Total number of HTTP requests",
  labelNames: ["method", "route", "status_code"],
});

// Agent metrics
export const agentExecutionDuration = new Histogram({
  name: "agent_execution_duration_seconds",
  help: "Duration of agent executions",
  labelNames: ["user_id", "model", "success"],
});

export const agentExecutionsTotal = new Counter({
  name: "agent_executions_total",
  help: "Total number of agent executions",
  labelNames: ["user_id", "model", "success"],
});

// Model metrics
export const modelTokensUsed = new Counter({
  name: "model_tokens_used_total",
  help: "Total tokens used",
  labelNames: ["user_id", "provider", "model", "type"], // type: input/output
});

// User metrics
export const activeUsers = new Gauge({
  name: "active_users",
  help: "Number of active users",
});

export const connectedChannels = new Gauge({
  name: "connected_channels_total",
  help: "Number of connected channels",
  labelNames: ["channel"],
});
```

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**
- [ ] Setup Docker development environment
- [ ] Create production Kubernetes manifests
- [ ] Setup CI/CD pipeline (GitHub Actions)
- [ ] Setup monitoring (Prometheus + Grafana)
- [ ] Setup logging (Loki)
- [ ] Setup error tracking (Sentry)
- [ ] Setup uptime monitoring
- [ ] Create deployment runbooks
- [ ] Create disaster recovery plan
- [ ] Load testing

---

### **Ğ¤Ğ°Ğ·Ğ° 8: Testing, Security & Launch** (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 8.1 Security Checklist

**Authentication & Authorization:**
- [ ] Implement JWT with refresh tokens
- [ ] Implement OAuth2 flows (Google, GitHub)
- [ ] Implement RBAC (Role-Based Access Control)
- [ ] Session management (Redis)
- [ ] Rate limiting (per user, per IP)
- [ ] CSRF protection
- [ ] XSS protection (CSP headers)

**Data Security:**
- [ ] Encrypt API keys at rest (AES-256-GCM)
- [ ] Encrypt sensitive data in database
- [ ] Use parameterized queries (SQL injection prevention)
- [ ] Secure file uploads (type validation, size limits)
- [ ] Sanitize user inputs
- [ ] Implement data retention policies

**Infrastructure Security:**
- [ ] HTTPS everywhere (TLS 1.3)
- [ ] Secure headers (HSTS, CSP, etc.)
- [ ] Database connection encryption
- [ ] Redis password authentication
- [ ] Network segmentation (VPC)
- [ ] Firewall rules
- [ ] DDoS protection (Cloudflare)
- [ ] Regular security audits

**User Privacy:**
- [ ] GDPR compliance (data export, deletion)
- [ ] Privacy policy
- [ ] Terms of service
- [ ] Cookie consent
- [ ] Data anonymization for analytics

#### 8.2 Testing Strategy

**Unit Tests:**
- [ ] Service layer tests (>80% coverage)
- [ ] Repository layer tests
- [ ] Utility function tests

**Integration Tests:**
- [ ] API endpoint tests
- [ ] Database integration tests
- [ ] Redis integration tests
- [ ] Auth flow tests

**E2E Tests:**
- [ ] User registration flow
- [ ] Channel connection flow
- [ ] Agent execution flow
- [ ] Payment flow
- [ ] Settings update flow

**Load Tests:**
- [ ] API load tests (k6 Ğ¸Ğ»Ğ¸ Artillery)
- [ ] Database performance tests
- [ ] Gateway concurrency tests
- [ ] Model inference load tests

#### 8.3 Launch Checklist

**Pre-Launch:**
- [ ] Complete all features (Phase 1-7)
- [ ] Security audit passed
- [ ] Load testing passed
- [ ] All tests passing
- [ ] Documentation complete
- [ ] Legal documents ready (TOS, Privacy Policy)
- [ ] Support system ready (email, chat)
- [ ] Pricing finalized
- [ ] Payment processing tested

**Launch Day:**
- [ ] Deploy to production
- [ ] DNS setup
- [ ] SSL certificates
- [ ] Monitoring dashboards live
- [ ] Alerting configured
- [ ] Backup system verified
- [ ] Launch announcement (Twitter, Reddit, HN)
- [ ] Press release (optional)

**Post-Launch:**
- [ ] Monitor error rates
- [ ] Monitor user signups
- [ ] Monitor system performance
- [ ] Collect user feedback
- [ ] Quick bug fixes
- [ ] Feature iteration based on feedback

---

## Timeline Summary

| Ğ¤Ğ°Ğ·Ğ° | Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ | ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ |
|------|--------------|---------------------|
| **Ğ¤Ğ°Ğ·Ğ° 0: ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ°** | 1-2 Ğ½ĞµĞ´ĞµĞ»Ğ¸ | Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½, Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°, ADR |
| **Ğ¤Ğ°Ğ·Ğ° 1: Multi-Tenant Foundation** | 3-4 Ğ½ĞµĞ´ĞµĞ»Ğ¸ | User management, auth, workspace isolation |
| **Ğ¤Ğ°Ğ·Ğ° 2: Centralized Bot Hub** | 2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸ | Shared bots, connection flow |
| **Ğ¤Ğ°Ğ·Ğ° 3: User Config & API Keys** | 2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸ | Per-user config, API key encryption, model proxy |
| **Ğ¤Ğ°Ğ·Ğ° 4: Web Search & Integrations** | 2 Ğ½ĞµĞ´ĞµĞ»Ğ¸ | SearXNG integration, search tool |
| **Ğ¤Ğ°Ğ·Ğ° 5: Web Dashboard** | 3-4 Ğ½ĞµĞ´ĞµĞ»Ğ¸ | Full-featured web UI |
| **Ğ¤Ğ°Ğ·Ğ° 6: Billing & Subscriptions** | 2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸ | Stripe integration, plans, quotas |
| **Ğ¤Ğ°Ğ·Ğ° 7: Deployment** | 2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸ | Infrastructure, CI/CD, monitoring |
| **Ğ¤Ğ°Ğ·Ğ° 8: Testing & Launch** | 2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸ | Security audit, load tests, launch |
| **TOTAL** | **19-27 Ğ½ĞµĞ´ĞµĞ»ÑŒ** | **Production-ready SaaS platform** |

---

## MVP Scope (First Release)

Ğ”Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ MVP Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ¼ Ñ„Ğ¸Ñ‡:

### MVP Features:
1. âœ… User registration (email + Google OAuth)
2. âœ… One centralized Telegram bot
3. âœ… One-click Telegram connection
4. âœ… Platform-hosted models (Llama 3.1 8B Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾)
5. âœ… Basic web dashboard (dashboard, channels, settings)
6. âœ… Free tier only (no billing)
7. âœ… Basic web search (SearXNG)
8. âœ… Session management
9. âœ… Basic monitoring

### Post-MVP (Future Phases):
- WhatsApp, Discord support
- Custom API keys (Claude, GPT)
- Pro/Team tiers + billing
- Advanced analytics
- Team workspaces
- Custom model deployments
- Mobile apps

**MVP Timeline: 10-14 Ğ½ĞµĞ´ĞµĞ»ÑŒ**

---

## Tech Stack Summary

| Layer | Technology | Notes |
|-------|-----------|-------|
| **Frontend** | Next.js 14, shadcn/ui, Tailwind | Modern React stack |
| **Backend** | Node.js, Express/Fastify | Existing gateway foundation |
| **Database** | PostgreSQL, Redis | User data + cache |
| **Storage** | S3-compatible (MinIO/AWS S3) | Media files |
| **Auth** | JWT, OAuth2 (Google) | NextAuth.js |
| **LLM Hosting** | Ollama / vLLM | Self-hosted models |
| **Search** | SearXNG | Self-hosted search |
| **Billing** | Stripe | Payment processing |
| **Monitoring** | Prometheus, Grafana, Sentry | Observability |
| **Deployment** | Docker, Kubernetes | Containerized |
| **CI/CD** | GitHub Actions | Automated testing + deploy |

---

## Team & Resources

**Recommended Team:**
- 1-2 Backend Engineers (Node.js, PostgreSQL)
- 1 Frontend Engineer (React, Next.js)
- 1 DevOps Engineer (Kubernetes, CI/CD)
- 0.5 Designer (UI/UX)

**Infrastructure Costs (estimated):**
- Compute (GPU for LLM): $500-1000/month
- Database (managed PostgreSQL): $100-200/month
- Redis (managed): $50-100/month
- Storage (S3): $50-100/month
- CDN + Load Balancer: $50-100/month
- Monitoring: $50-100/month
- **Total: ~$800-1600/month** (Ğ´Ğ¾ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)

---

## Risk Mitigation

### Technical Risks:
1. **LLM Hosting Cost** - Solution: Start with smaller models, optimize inference
2. **User Workspace Disk Usage** - Solution: Implement quotas, cleanup policies
3. **Database Scaling** - Solution: Read replicas, caching, sharding plan
4. **Bot Rate Limits (Telegram)** - Solution: Queue messages, implement backoff

### Business Risks:
1. **User Acquisition** - Solution: Free tier, referral program, content marketing
2. **API Key Trust** - Solution: Strong encryption, security audit, transparency
3. **Competition** - Solution: Focus on ease-of-use, multi-channel, self-hosted option
4. **Abuse/Spam** - Solution: Rate limiting, content moderation, reporting system

---

## Next Steps

1. **Week 1-2:** Complete Ğ¤Ğ°Ğ·Ğ° 0 (technical design, architecture decisions)
2. **Week 3:** Start Ğ¤Ğ°Ğ·Ğ° 1 (user management, auth)
3. **Week 4-6:** Continue Ğ¤Ğ°Ğ·Ğ° 1 + Ğ¤Ğ°Ğ·Ğ° 2 (bot hub)
4. **Review & Iterate:** Weekly progress reviews, adjust timeline

**First Milestone: Working Telegram bot with user registration (Week 6)**

---

## Resources & Documentation

- **Clawdbot Docs:** https://docs.clawd.bot
- **Architecture Diagrams:** [Create in Excalidraw/Figma]
- **API Spec:** [Create OpenAPI spec]
- **Database Schema:** [Create ER diagram]
- **Deployment Guide:** [Write deployment runbook]
- **Security Audit:** [Schedule before launch]

---

**Ğ£Ğ´Ğ°Ñ‡Ğ¸ Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼ SaaS Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹! ğŸš€**
